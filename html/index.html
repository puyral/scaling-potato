

<!DOCTYPE html>
<html>
    <head>
        <title>Cours Complet Bootstrap 4</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <style>
            .custom-line{
                min-height: 5rem;
                margin-bottom: 1rem;
                background-color: RGBa(60,240,160,0.7); /*Vert*/
            }
            .custom-line > .col{
                background-color: RGBa(60,120,240,0.7); /*Bleu*/
            }
        </style>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    </head>
    <body>



    <!-- Optional JavaScript -->

        <!--Les classes bg-info et mb-3 servent à appliquer un fond bleu et une marge extérieure basse de 
         taille moyenne au div-->

        <!--La classe border ajoute des bordures grises autour de l'élément--> <div class="container">
            
             <div class="container">
           <!--Les classes .p-3 et .mb-2 servent simplement à définir un 
           padding et une marge extérieure basse pour séparer nos divs.
           La classe border permet d'ajouter des bordures-->

        <h1>Get all the users info</h1>

            

            <!-- Button for selecting users -->

            <form>
               <fieldset>
                 <legend>Research now the pseudo of a wikipedia users to get all his profile.</legend>
                 
                 <div class="form-group">
                   <label >Users Name : </label>
                   <input type="text" class="form-control" id="usersName" placeholder="A3nm">
                 </div>
                 
                 <div class="form-group">
                   <label >Language?</label>
                   <input type="text" class="form-control" id="language" placeholder="fr">
                 </div>
                 

                <div class="form-group">
                   <label >Number of queries?</label>
                   <input type="text" class="form-control" id="nbQueries" placeholder="50">
                 </div>

               </fieldset>
             </form>


            <button type="button" class ="btn btn-success mb-2" onclick="getValue();">Go !</button>
            

            <!-- General info about the users -->
            <p id="name"></p>
            <p id="blockinfo"></p>
            <p id="groups"></p>
            <p id="editcount"></p>
            <p id="registration"></p>
            <p id="emailable"></p>
            <p id="gender"></p>

            <!-- All the queries he did  -->

            <!--<p id="infoE"></p> -->


            <div class="container" id="tab">

            


            </div>

            </div>



       </div>
     
    </body>
</html>



<script type="text/javascript">
    

    function getValue() {  /* function to get the value in the input*/ 


        var usersName = document.getElementById("usersName").value;
        var language = document.getElementById("language").value;
        var nbQueries = document.getElementById("nbQueries").value;

        changeThings(usersName,language,nbQueries);
    }



    function createRow(PagesEdit,DaysEdit,DeltaEdit,CategoriesEdit){    /* Creates the row off the tab */

          document.getElementById("tab").innerHTML += "<div class='row'> <div class='col bg-info' >"+PagesEdit+"</div> <div class='col bg-info' >"+DaysEdit+"  </div> <div class='col bg-info' > "+DeltaEdit+" </div> <div class='col bg-info' > "+CategoriesEdit+" </div></div>";

    }


    function createRows(b,usersC,L){  /* Go through all the queries the users made (usersC), and display in a tab the differentes queries with relevant information  */ 
        a = 0;
        for (var u in usersC){

            if (Math.floor(a/20) ==b){

                console.log(usersC[u].title)
                PagesEdit = usersC[u].title;
                DaysEdit = usersC[u].timestamp ;
                DeltaEdit = usersC[u].sizediff;
                CategoriesEdit = L[usersC[u].title];

               createRow(PagesEdit,DaysEdit,DeltaEdit,CategoriesEdit);
            }
            a+=1;
        }
    }


                       


    function changeThings(usersName,language,nbQueries){ /*To update with the value that we get from the input*/

        /* We construct the first url , to get the info about the user*/
        var url = "https://"+ language+ ".wikipedia.org/w/api.php"; 
        var params = {
            action: "query",
            list: "users",
            ususers: usersName,
            usprop: "blockinfo|groups|editcount|registration|emailable|gender",
            format: "json"
        };

        url = url + "?origin=*";
        Object.keys(params).forEach(function(key){url += "&" + key + "=" + params[key];});   
        console.log(url);
        fetch(url)
            .then(function(response){return response.json();})
            .then(function(response) {
                /*Define all the variables usefull to show after*/
                var users = response.query.users;
                var xname = users[0].name;
                var xblockinfo = users[0].blockinfo;
                var xgroups = users[0].groups;
                var xeditcount = users[0].editcount;
                var xregistration = users[0].registration;
                var xemailable = users[0].emailable;
                var xgender = users[0].gender;
                /*Show the different value*/
                document.getElementById("name").innerHTML =
                    " <strong> Nom de l'utilisateur : </strong> " +xname;
                document.getElementById("blockinfo").innerHTML =
                    " " +xblockinfo;
                document.getElementById("groups").innerHTML =
                    "<strong>Groupe de l'utilisateur : </strong> " +xgroups;
                document.getElementById("editcount").innerHTML =
                    "<strong>Nombre d'édits de l'utilisateur : </strong> " +xeditcount;
                document.getElementById("registration").innerHTML =
                    "<strong> Date d'enregistrement sur wikipedia : </strong> " +xregistration;
                document.getElementById("emailable").innerHTML =
                    " <strong>Email, si renseigné : </strong> " +xemailable;

            })

        /*Second request to get the different queries of that user*/
        var url = "https://"+ language+ ".wikipedia.org/w/api.php"; 
        var params = {
            action: "query",
            list: "usercontribs",
            ucuser: usersName,
            ucprop: "ids|title|comment|size|sizediff|timestamp|tags",
            format: "json",
            ucshow:"!minor",
            uclimit:nbQueries,
            ucnamespace:"0"
        };

        url = url + "?origin=*";
        Object.keys(params).forEach(function(key){url += "&" + key + "=" + params[key];}); /*Constructing the url*/
        console.log(url);

        fetch(url)
            .then(function(response){return response.json();})
            .then(function(response) {
                var usercontribs = response.query.usercontribs; 
                /*var x = ""; /* The following variable will contain all the important info about the queries of the users and then will be print in the different columns */

                var PagesEdits = "";
                var DaysEdits = "";
                var DeltaEdits = "";
                var CategoriesEdits = "";



                document.getElementById("tab").innerHTML = "<div class='row'> <div class='col bg-info' > Page </div> <div class='col bg-info' > Jour de l'édit </div> <div class='col bg-info' > DeltaSize </div> <div class='col bg-info' > Categories </div></div>";

                usersC = usercontribs.sort(function(a,b){   /*We sort the contribution by the absolute value of delta size */
                    if (Math.abs(a.sizediff) < Math.abs(b.sizediff) ){ return 1; } 
                    if (Math.abs(a.sizediff) > Math.abs(b.sizediff) ){ return -1;}
                    return 0; 
                })

                var L1 = "";
                var L2 ="";
                var L3 ="";
                var L4 ="";
                var L5 ="";
                var L6 ="";
                var L7 ="";
                var L8 ="";
                var L9 ="";
                var L10 ="";

                var i1 = 0;
                var i2 = 0;
                var i3 = 0;
                var i4 = 0;
                var i5 = 0;
                var i6 = 0;
                var i7 = 0;
                var i8 = 0;
                var i9 = 0;
                var i10 = 0;


                var a = 0;
                for (var u in usersC){
                    switch(Math.floor(a/20)) {
                        case 0 :
                            console.log(usercontribs[u].title)
                            L1+="|"+usercontribs[u].title;
                            i1 += 1;                            
                        case 1 :
                            
                            L2+="|"+usercontribs[u].title;
                            i2 += 1;
                        case 2 :

                            L3+="|"+usercontribs[u].title;
                            i3 += 1;
                        case 3 :

                            L4+="|"+usercontribs[u].title;
                            i4 += 1;
                        case 4 :

                            L5+="|"+usercontribs[u].title;
                            i5 += 1;
                        case 5 :

                            L6+="|"+usercontribs[u].title;
                            i6 += 1;
                        case 6 :

                            L7+="|"+usercontribs[u].title;
                            i7 += 1;
                        case 7 :

                            L8+="|"+usercontribs[u].title;
                            i8 += 1;
                        case 8 :

                            L9+="|"+usercontribs[u].title;
                            i9 += 1;
                        case 9 :

                            L10+="|"+usercontribs[u].title;
                            i10 += 1;
                    }
                    a+=1;
                }
                
                L1 = L1.substring(1,L1.length);
                console.log(L1);

                /* For each pages that the user has edited, we research for the category*/
                var url1 = "https://"+language+".wikipedia.org/w/api.php";
                var url2 = "https://"+language+".wikipedia.org/w/api.php"; 
                var url3 = "https://"+language+".wikipedia.org/w/api.php"; 
                var url4 = "https://"+language+".wikipedia.org/w/api.php"; 
                var url5 = "https://"+language+".wikipedia.org/w/api.php"; 
                var url6 = "https://"+language+".wikipedia.org/w/api.php"; 
                var url7 = "https://"+language+".wikipedia.org/w/api.php"; 
                var url8 = "https://"+language+".wikipedia.org/w/api.php"; 
                var url9 = "https://"+language+".wikipedia.org/w/api.php"; 
                var url10 = "https://"+language+".wikipedia.org/w/api.php"; 





                var dictURL = {};
                var params = {
                    action: "query",
                    format: "json",
                    prop: "categories",
                    clshow: "!hidden",
                    cllimit:500,
                    titles: ""
                };

                for (i = 0; i<11;i++){
                    switch(i){

                        case 0:
                            params["titles"] = L1
                            url1 = url1 + "?origin=*";
                            Object.keys(params).forEach(function(key){url1 += "&" + key + "=" + params[key];});
                            dictURL[1] = url1;


                        case 1:
                            params["titles"] = L2
                            url2 = url2 + "?origin=*";
                            Object.keys(params).forEach(function(key){url2 += "&" + key + "=" + params[key];});
                            dictURL[2] = url2;

                        case 2:
                            params["titles"] = L3
                            url3 = url3 + "?origin=*";
                            Object.keys(params).forEach(function(key){url3 += "&" + key + "=" + params[key];});
                            dictURL[3] = url3;

                        case 3:
                            params["titles"] = L4
                            url4 = url4 + "?origin=*";
                            Object.keys(params).forEach(function(key){url4 += "&" + key + "=" + params[key];});
                            dictURL[4] = url4;

                        case 4:
                            params["titles"] = L5
                            url5 = url5 + "?origin=*";
                            Object.keys(params).forEach(function(key){url5 += "&" + key + "=" + params[key];});
                            dictURL[5] = url5;


                        case 5:
                            params["titles"] = L6
                            url6 = url6 + "?origin=*";
                            Object.keys(params).forEach(function(key){url6 += "&" + key + "=" + params[key];});
                            dictURL[6] = url6;

                        case 6:
                            params["titles"] = L7
                            url7 = url7 + "?origin=*";
                            Object.keys(params).forEach(function(key){url7 += "&" + key + "=" + params[key];});
                            dictURL[7] = url7;

                        case 7:
                            params["titles"] = L8
                            url8 = url8 + "?origin=*";
                            Object.keys(params).forEach(function(key){url8 += "&" + key + "=" + params[key];});
                            dictURL[8] = url8;

                        case 8:
                            params["titles"] = L9
                            url9 = url9 + "?origin=*";
                            Object.keys(params).forEach(function(key){url9 += "&" + key + "=" + params[key];});
                            dictURL[9] = url9;

                        case 9:
                            params["titles"] = L10
                            url10 = url10 + "?origin=*";
                            Object.keys(params).forEach(function(key){url10 += "&" + key + "=" + params[key];});
                            dictURL[10] = url10;

                    }
                }









                let categ = ""; /*Variable that will contains all the categories of these page*/
                var L = {};
            








                console.log(dictURL[1]);
                fetch(dictURL[1])   
                    .then(function(response){return response.json();})
                    .then(function(response) {
                        var pages = response.query.pages;
                       

                        var L = {};


                        for (var p in pages) {
                            let categ = "";
                            try {
                                for (var cat of pages[p].categories) {
                                categ += cat.title+"  ;  " ; /* We add the categories*/
                                }
                                L[pages[p].title]=categ;
                            } catch(TypeError) {
                                categ = "";
                            }
                        }          

                        return L;
                    })               

                    .then(function(response) {

                        L = response;
                        let categ = "";

                        if (i2 >0){
                            
                            fetch(dictURL[2])   
                                .then(function(response){return response.json();})
                                .then(function(response) {
                                    var pages = response.query.pages;
                                    var L = {};
                                    for (var p in pages) {
                                        let categ = "";
                                        try {
                                            for (var cat of pages[p].categories) {
                                            categ += cat.title+"  ;  " ; /* We add the categories*/
                                            }
                                            L[pages[p].title]=categ;
                                        } catch(TypeError) {

                                            categ = "";
                                        }
                                    }                        

                                    return L;

                                })
                                .then(function(response){

                                    L = response;
                                    b = 0;
                                    createRows(b,usersC,L);
                                    b = 1 ;
                                    createRows(b,usersC,L);



                                }




                                    )

                            }

                        })      

    })

    }

</script>
