
<!DOCTYPE html>
<html>
    <head>
        <title>Wiki Users Info</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <style>
            .custom-line{
                min-height: 5rem;
                margin-bottom: 1rem;
                background-color: RGBa(60,240,160,0.7); /*Vert*/
            }
            .custom-line > .col{
                background-color: RGBa(60,120,240,0.7); /*Bleu*/
            }
            .example {
                text-align: center;
                text-align: justify;
            }

        </style>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

        <script src="https://cdn.anychart.com/releases/v8/js/anychart-core.min.js"></script>
<script src="https://cdn.anychart.com/releases/v8/js/anychart-cartesian.min.js"></script>


    </head>
    <body>



    <!-- Optional JavaScript -->

        <!--Les classes bg-info et mb-3 servent à appliquer un fond bleu et une marge extérieure basse de 
         taille moyenne au div-->

        <!--La classe border ajoute des bordures grises autour de l'élément--> <div class="container " >
            
             <div class="container ">
           <!--Les classes .p-3 et .mb-2 servent simplement à définir un 
           padding et une marge extérieure basse pour séparer nos divs.
           La classe border permet d'ajouter des bordures-->

        <h1>Get all the users info</h1>




            <div class= "row border">
                
                <form>
                <fieldset>
                <legend>Research now the pseudo of a wikipedia users to get all his profile.</legend>
                </fieldset>
                </form>

            </div>

            <div class='row '> 
                <div class='col-4 bg-info' >
                    <div class="form-group">
                        <label >Users Name : </label>
                        <input type="text" class="form-control" id="usersName" value="A3nm">
                    </div>
                </div>
                <div class='col-1 bg-white border' > 
                </div>

                <div class='col-md bg-info border border-right-0' >
                    <div class='row example border border-right-0' >
                       <strong> Users Name </strong>
                    </div>
                    <div class='row example' id = "name">
                       
                   </div>
                </div>
                <div class='col-md bg-info border border-right-0' >
                    <div class='row example border border-right-0'>
                        <strong>User's groups  </strong> 
                    </div>
                    <div class='row example ' id = "groups">
                    </div>
                </div>
             </div>
             <div class='row '> 
                <div class='col-4 bg-info' >
                    <div class="form-group">
                        <label >Language?</label>
                        <input type="text" class="form-control" id="language" value="fr"placeholder="fr">
                    </div>
                </div>
                <div class='col-1 bg-white' > 
                </div>
                <div class='col-md bg-info border border-right-0' >
                    <div class='row example border border-right-0' >
                        <strong>Edits count </strong> 
                    </div>
                    <div class='row example ' id = "editcount">
                        
                    </div> 
                </div>
                <div class='col-md bg-info border border-right-0' >
                    <div class='row example border border-right-0' >
                        <strong> Registration Date </strong> 
                    </div> 
                     <div class='row example ' id = "registration">
                    
                    </div> 
                </div>
             </div>
             <div class='row '> 
                <div class='col-4 bg-info' >
                     <div class="form-group">
                   <label >Number of months?</label>
                   <input type="text" class="form-control" id="nbMonths" value="24" placeholder="24">
                 </div>
                </div>
                <div class='col-1 bg-white' > </div>
                <div class='col-md bg-info border border-right-0' >
                    <div class='row example border border-right-0' >
                    <strong>Email, if informed : </strong>
                    </div>
                    <div class='row example' id = "emailable">
                    
                    </div>
                </div>
                <div class='col-md bg-info border border-right-0' >
                    <div class='row example border border-right-0' >
                     <strong>Last modification : </strong> 
                    </div>
                    <div class='row example' id ="latestcontrib">
                     
                    </div>    
                </div>
            </div>
            <div class='row'> 
                <button type="button" class ="btn btn-success mb-2" onclick="getValue();">Go !</button>
            </div>


            <!-- All the queries he did  -->

            <!--<p id="infoE"></p> -->
        <div class="row mt-3" id ="Loading" hidden = true>
            
           <img src="assets/Loading.gif" alt="Loading" title="A moment please!">
        </div>

        <div id = Graphic > 
            <canvas id="container"  style ="height: 400px;">
            </canvas>
        </div>
        <div class="row mt-3" id ="Titre">
        </div>
        <div class="row mt-3" id ="displayInfo">
            <div class='col-3 bg-white' id=titleInfo > 
            </div>

            <div class='col bg-white' id=infoQueries > 
            </div>

        </div>

        <div class="container mt-3" id = "tab">

        </div>

    </div>
    </body>
</html>



<script type="text/javascript"  >
    

    function getValue() {  /* function to get the value in the input*/ 


        var usersName = document.getElementById("usersName").value;
        var language = document.getElementById("language").value;
        var nbMonths = document.getElementById("nbMonths").value;

        changeThings(usersName,language,nbMonths);  /*Call the function who will do the main work here.*/
    }



    function createURLpage(name,language){   /*  Creer le lien pour la page wikipedia qu'on souhaite */
            name2 = name.split(' ').join('_');
            var url = "https://"+language+".wikipedia.org/wiki/"+name2;
            var complet = "<a href="+url+ " class = "+ '"text-white">'+name+"</a>";
            
            return complet;
        }

    function createRow(PagesEdit,DaysEdit,DeltaEdit,CategoriesEdit,language,i){  /* Creates the row off the tab */
        var URLpage = createURLpage(PagesEdit,language);
        /*document.getElementById("innerTab").innerHTML += "<div class='row'> <div class='col bg-info' >"+URLpage+"</div> <div class='col bg-info' >"+DaysEdit+"  </div> <div class='col bg-info' > "+DeltaEdit+" </div> <div class='col bg-info' > "+CategoriesEdit+" </div></div>"; */
       
        document.getElementById("innerTab").innerHTML += "<div class='row'> <div class='col-2 bg-info  border' >"+URLpage+"</div> <div class='col-2 bg-info  border' >"+DaysEdit+"  </div> <div class='col-1 bg-info  border' > "+DeltaEdit+" </div> <div class='col-6 bg-info  border' > <div class='row' id = "+((i+1)*1000+1)+" hidden = true >"+CategoriesEdit+" </div><div class= 'row'><button type='button' class ='btn btn-success mb-2' onclick= "+'" displayValue(+'+((i+1)*1000+1)+','+10+');"'+">See categories </button></div></div></div>";
    }

    function createRows(usersC,L,language,plateau,separation){/* Go through all the queries the users made (usersC), and display in a tab the differentes queries with relevant information  */ 
        a = 0;
        for (var u in usersC){  
            PagesEdit = usersC[u].title;
            DaysEdit = usersC[u].timestamp ;
            DeltaEdit = usersC[u].sizediff;
            CategoriesEdit = L[usersC[u].title];
            createRow(PagesEdit,DaysEdit,DeltaEdit,CategoriesEdit,language,u);
            }
            a+=1;
        }
    

    function findPage(usersC,id){  /*Do exaustif search to find the query matching the id i*/

        L = [];
        for (var u in usersC){
            if (usersC[u].pageid == id){     
                return usersC[u];
            }
        }
        return L;
    }

    function fillPage(usersC,language,L,n,D,j,nbMainCat){/* Will display on screen the main information about the categories the users edit*/ 
        a = 0;
        
        for (i=0;i<n;i++){/*  In this example we sort by the number D[i][2]. As the list is assumed to be already sorted, we just go through it to display the first 10 */
            var idpage = D[i][0];               /*id of the page*/
            findPAGE = findPage(usersC,idpage);
            var PagesEdit = findPAGE.title;
            var DaysEdit = findPAGE.timestamp ;
            var DeltaEdit = findPAGE.sizediff;
            var CategoriesEdit = L[PagesEdit];
            var Numberofview = D[i][2];
            var urlPage = createURLpage(PagesEdit,language);
            createLineinCategories(j,urlPage,DeltaEdit,CategoriesEdit,DaysEdit,Numberofview,i,nbMainCat);
        }
    }


    function createTimestemps(date,D){ /* D est le nombre de mois */

        var timestamps = "2021-02-01T14:56:00Z";
        var m1 = parseInt(timestamps[6]);
        var m2 = parseInt(timestamps[5]);
        var m3 = parseInt(timestamps[3]);
        var m4 = parseInt(timestamps[2]);
        var L = [];
        for (i = 0; i <D; i++){
            if (m2 ==1) {
                if(m1 == 0) {
                    m1 = 9;
                    m2 = 0;
                }
                else {
                    m1 = m1 -1;
                }
            }
            else {
                if(m1== 1){
                    m1 = 2;
                    m2 = 1;
                    if (m3>0){
                        m3 = m3 -1;
                    }
                    else {
                        m3 = 9;
                        m4 = m4-1;
                    }   
                }
                else {
                    m1 = m1-1;
                }
            }
            timestamps2 = "20"+m4.toString() + m3.toString() + "-"+ m2.toString()+ m1.toString() +"-01T14:56:00Z";
            L.push(timestamps2); 
        }
        return L;

    }


    function createLineinCategories(i,URLpage,DeltaEdit,CategoriesEdit,DaysEdit,Numberofview,line,nbMainCat){

        
        var istring = i.toString();
        
        document.getElementById(istring).innerHTML += "<div class='row'> <div class='col-2 bg-info  border' >"+URLpage+"</div> <div class='col-2 bg-info  border' >"+DaysEdit+"  </div> <div class='col-1 bg-info  border' > "+DeltaEdit+" </div><div class='col-1 bg-info  border' > "+Numberofview+" </div> <div class='col-6 bg-info  border' > <div class='row' id = "+((line+1)*10+i)+" hidden = true >"+CategoriesEdit+" </div><div class= 'row'><button type='button' class ='btn btn-success mb-2' onclick= "+'" displayValue(+'+((line+1)*10+i)+','+10+');"'+">See categories </button></div></div></div>";
        
    }

    function createBlock(n,D){
        document.getElementById("titleInfo").innerHTML = "";
        document.getElementById("infoQueries").innerHTML = "";
        for (i=0;i<n;i++){
            if (i <n){
                document.getElementById("titleInfo").innerHTML += "<div class='col bg-info border' ><h3>"+D[i]+" </h3> <button type='button' class ='btn btn-success mb-2' onclick= "+'" displayValue(+'+i+','+n+');"'+">Display main queries </button>  </div>";
                document.getElementById("infoQueries").innerHTML += "<div class='col bg-info' hidden = true id =" +i+ "  ></div>"
            }
        }
    }

     function displayValue(i,n){   /*enables the users to one value or anothe*/

        if (i ===parseInt(i,10)){
            var istring = i.toString();
        }
        else {
            var istring = i.id;
        }

        if (n < 10 ){

            for (j = 0; j <n; j++){

                if (j == i){
                    if (document.getElementById(istring).hidden == false){
                        document.getElementById(istring).hidden = true;
                    }
                    else {
                        document.getElementById(istring).hidden = false;
                    }
                } else
                document.getElementById(j).hidden = true;
            }

        }
        else{
            if (document.getElementById(istring).hidden == false){
                document.getElementById(istring).hidden = true;
                }
            else {
                document.getElementById(istring).hidden = false;
            }

        }
        
    }



    function getAverage(L,K){  /*computes the average*/
        x = 0;
        i = 0;
        for (key in K){
            x = x + L[K[key]];
            i++;
        }
        return Math.round(x /i*100)/100;
    }


    function createURLdifferentTime(lTimeStamp,language,usersName,Size){

        var L = [];
        for (var i=0; i<=Size;i++){
            var url = "https://"+ language+ ".wikipedia.org/w/api.php"; 
            var params = {
                action: "query",
                list: "usercontribs",
                ucuser: usersName,
                ucprop: "ids|title|comment|size|sizediff|timestamp|tags",
                format: "json",
                ucshow:"!minor",
                ucend:lTimeStamp[i+1],
                ucstart:lTimeStamp[i],
                uclimit:500,
                ucnamespace:"0"

            };
            url = url + "?origin=*";
            Object.keys(params).forEach(function(key){url += "&" + key + "=" + params[key];}); /*Constructing the url*/
            L.push(url)
        }
        return L;
    }

    function createTitles(usercontribs,L,borne){
        /* We create here the Titles for the different queries to the url. The list L contains the different part of userscontribs we have to use.
        If borne is not 0, it means that we are only interested in the pages of on single element of usercontribs, which have more than 50 element, and thus, that we have split in different part.*/

        var m = "";
        var compteur = 0;
        for (var i in L){
            for (var u in usercontribs[L[i]]){
                if (compteur <50 && (parseInt(u)+borne)<usercontribs[L[i]].length){
                   m += "|"+usercontribs[L[i]][parseInt(u)+borne].title;
                   compteur += 1; 
                }
            }
        }
        m = m.substring(1,m.length);
        return m;

    }

    function createURLCategories(titles,language){

        var L = [];
        
        var url = "https://"+ language+ ".wikipedia.org/w/api.php"; 
        var params = {
                action: "query",
                format: "json",
                prop: "categories|pageviews|links|linkshere",
                clshow: "!hidden",
                cllimit:500,
                titles: titles,
                pllimit : 500
            };
        url = url + "?origin=*";
        Object.keys(params).forEach(function(key){url += "&" + key + "=" + params[key];}); /*Constructing the url*/
        L.push(url)
        return L;
    }


    function getClass(n,L,separation){

        var b = 0;
        for ( var i in L){
            if (n < L[separation-1-i]){
                b = separation-1-i
            }
        }
        return b;
    }


    function getURLindexpage(language,L){

        /* pour chaque nom de L, on appel le server pour avoir l'id*/
        var listURL = [];
        for (var u in L){

            var url = "https://"+ language+ ".wikipedia.org/w/api.php"; 
                    var params = {
                            action: "query",
                            format: "json",
                            prop: "info",
                            titles:L[u]
                            
                        };
                    url = url + "?origin=*";
                    Object.keys(params).forEach(function(key){url += "&" + key + "=" + params[key];}); /*Constructing the url*/
                    listURL .push(url)
                    


        }
        return listURL ;
        
    }


    function changeThings(usersName,language,nbMonths){ /*To update with the value that we get from the input*/

        /* We construct the first url , to get the info about the user*/

        /*document.getElementById("name").innerHTML ="<strong>Users Name </strong>";
        document.getElementById("groups").innerHTML ="<strong>User's groups </strong> ";
        document.getElementById("editcount").innerHTML =" <strong>Edits count </strong> ";
        document.getElementById("registration").innerHTML ="<strong> Registration date </strong>";
        document.getElementById("emailable").innerHTML ="<strong> Email, if informed </strong> ";
*/
        document.getElementById("Graphic").innerHTML = '<div id="container"  style ="height: 400px;"></div>';
        /*document.getElementById("container")*/
        document.getElementById("Loading").hidden = false;
        var url = "https://"+ language+ ".wikipedia.org/w/api.php"; 
        var params = {
            action: "query",
            list: "users",
            ususers: usersName,
            usprop: "blockinfo|groups|editcount|registration|emailable|gender",
            format: "json"
        };

        url = url + "?origin=*";
        Object.keys(params).forEach(function(key){url += "&" + key + "=" + params[key];});   
        fetch(url)
            .then(function(response){return response.json();})
            .then(function(response) {
                /*Define all the variables usefull to show after*/
                console.log(response)
                var users = response.query.users;
                var xname = users[0].name;
                var xblockinfo = users[0].blockinfo;
                var xgroups = users[0].groups;
                var xeditcount = users[0].editcount;
                var xregistration = users[0].registration;
                var xemailable = users[0].emailable;
                var xgender = users[0].gender;
                /*Show the different value*/
                console.log(xname);
                document.getElementById("name").innerHTML =xname;
                /*document.getElementById("blockinfo").innerHTML =+xblockinfo;*/
                document.getElementById("groups").innerHTML =xgroups;
                document.getElementById("editcount").innerHTML =xeditcount;
                document.getElementById("registration").innerHTML =xregistration;
                document.getElementById("emailable").innerHTML =xemailable;

            })

        /*Second request to get the different queries of that user*/
        /* On va essayer de request le plus de queries possible, en utilisant different fetch. Ça va être assez sympa mais compliqué.
        attention les yeux*/

        /* on va commencer par une liste d'URL je pense.*/

        var listURLuserQueries = [];
        /* Le probleme c'est qu'on ne sait pas forcément comment découper en fonction du temps. Néamoins on peut se donner quelque chose d'assez simple. on va esasyer de lui demander de nous donner tout les queries qu,il a fait dans un mois à chaque fois.  Avec un peu de chance il n'aura pas fait plus de 500 queries dans le mois. 
        On n'a plus qu'a après balayer quelque choses genre 5 ans */
        timestampEx = "2021-03-01T14:56:00Z"

        
        var numberMonths = nbMonths;  /* Nombre de mois donné par l'utilisateur*/
        var lTimeStamp = createTimestemps("0000",numberMonths+1);
        listURLuserQueries = createURLdifferentTime(lTimeStamp,language,usersName,numberMonths-1);
        Promise.all(listURLuserQueries.map(url =>
            fetch(url).then(resp => resp.json())
        )).then(resp => {

             document.getElementById("tab").innerHTML = "<div class='row'><button type='button' class ='btn btn-success mb-2' onclick= "+'" displayValue(innerTab);"'+">Display all the last queries of the users </button> </div>";
            document.getElementById("tab").innerHTML += "<div class='row' > <div class='col-2 bg-primary' > <strong>Page</strong> </div> <div class='col-2 bg-primary' > <strong>Jour de l'édit </strong> </div> <div class='col-1 bg-primary' ><strong> DeltaSize </strong> </div> <div class='col-7 bg-primary' > <strong>Categories</strong>  </div></div><div class = 'container' id ='innerTab' hidden = true></div>";
            /*On va maintenant compter combien de queries on a*/
            var usercontribs = {};
            var NumberQueries = 0;
            var Partition = [];
            var V = [];
            var countInter = 0;
            var plateau = [];
            var usersC = [];
            var number = 0;
            var actionByMonths = [];
            var data = {}
            var actionByMonths2 = [];
            /* In this part I group and divide the different pages in blocks to be send to the server. Each of them have to be of a size < 50 to be accepted. */

            for (i=0;i<numberMonths;i++){
                K = resp[i].query.usercontribs;
                usercontribs[i] = K;
                var temp = {};

                actionByMonths.push([lTimeStamp[i].substring(0,10), K.length])
                /*temp["x"] = lTimeStamp[i].substring(0,10);
                temp["y"] =  K.length;
                actionByMonths.push(temp);*/
                actionByMonths2.push(K.length)
;                for (var u in K){

                    usersC[number] = K[u];
                    number+=1;
                }

                if (K.length > 50){
                    
                    Partition.push(V);
                    V = new Array();
                    plateau.push(NumberQueries);
                    var repeat = Math.floor(K.length/50);
                    
                    for (j =0; j<repeat;j++){
                    
                        V.push(i);
                        Partition.push(V);
                        V = new Array();
                        NumberQueries += 50;
                        plateau.push(NumberQueries)
                    }
                    V.push(i);
                    Partition.push(V);
                    V = new Array();
                    NumberQueries += (K.length-50*(repeat-1));
                    plateau.push(NumberQueries);
                    countInter = 0;
                }
                else {
                
                    NumberQueries += K.length;
                    countInter = countInter + K.length;
                    if (countInter > 50  ){
                        countInter = K.length;
                        Partition.push(V);
                        V = [];
                        plateau.push(NumberQueries);
                        

                    }
                    V.push(i);
                   
                    
                }
            }
            Partition.push(V);
            plateau.push(NumberQueries);
            var separation = Partition .length;

  
            console.log(actionByMonths2)

            /*var data = [
                    {x: 'Amazon', y: 120},
                    {x: 'DZone', y: 60},
                    {x: 'Gizmodo', y: 30},
                    {x: 'StackOverFlow', y: 80},
                    {x: 'CNET', y: 50}
                ];
            */
            var chart = anychart.column();
            chart.title("Evolution of the quantity of modification made by the users");
            chart.xAxis().title("Months");
            chart.yAxis().title("Nomber of modification");
            var series = chart.column(actionByMonths);
            chart.container("container");
            chart.draw();
          

            console.log(actionByMonths);

            var usersC = usersC.sort(function(a,b){   /*We sort the contribution by the absolute value of delta size. */
                    if (Math.abs(a.sizediff) < Math.abs(b.sizediff) ){ return 1; } 
                    if (Math.abs(a.sizediff) > Math.abs(b.sizediff) ){ return -1;}
                    return 0; 
                })

            

            /* Now we desgin the url to get the categories associated.*/


            listURLCategories = [];
            var borne = 0;
            for (var e in Partition ){
                if (Partition[e-1] == Partition[e]){
                    borne += 1;
                }
                else {
                    borne = 0;
                }
                var title = createTitles(usercontribs,Partition[e],borne*50);   /* Each Url will get a different "Title", wich is the titles of the different pages we saerch. There are at most 50 pages in the block.*/
                var Url = createURLCategories(title,language);
                listURLCategories.push(Url);
            }

            console.log(listURLCategories);


            Promise.all(listURLCategories.map(url =>  /* We fetch all the url */
                fetch(url).then(resp2 => resp2.json())
            )).then(resp2 => {

                
                var L = {};
                var pageViews = [];
                var links = [];
                var linkshere = [];

                var jsonServeur = [];
                var group ={};
                var correspondance = []
                
                /*var dictLengthCategoriesDifferentLanguage = {

                    als : 10;
                    br : 7;
                    en : 9;
                    it : 10;
                    oc:10;
                    pcd: 10;
                    pt: 10;
                    fr:10;
                    eo: 10;
                    de:10
                }*/
                console.log(resp2);

                for (var i= 0;i<separation; i++){  /* For each fetchs… there is 10 fetchs*/ 
                    
                    var pages = resp2[i].query.pages;
                    for (var p in pages) {
                        let categ = "";  /*Variable that will contains all the categories of these page*/
                        try {
                            for (var cat of pages[p].categories) {


                                var index = cat.title.indexOf(":");
                                var mot = cat.title.substring(index+1,cat.title.length);
                                categ += mot + " </br>" ; /* We add the categories*/

                                correspondance.push(cat.title);
                                blockCategories.push(p);

                            }
                            L[pages[p].title]=categ;
                        } catch(TypeError) {
                            categ = "";
                        }
                        try {
                            key = Object.keys(pages[p].pageviews);
                            LpageV = pages[p].pageviews;
                            var A = getAverage(LpageV,key);
                            pageViews.push([p,pages[p].title,A]);
                            links.push([pages[p].title,pages[p].links]);
                            linkshere.push([pages[p].title,pages[p].linkshere]);
                        }

                        catch(TypeError){
                            var doNothing = 0;
                            
                        }                                    
                    }
                }

                
                URLindexListe = getURLindexpage(language,correspondance);
                console.log(URLindexListe);


                Promise.all(URLindexListe.map(url =>  /* We fetch all the url */
                    fetch(url).then(resp3 => resp3.json())
                )).then(resp3 => {

                        console.log("YOUUUUUUUUU");
                        console.log(resp3);

                        correspondanceIdNom = {}
                        var blockCategories = [];


                        for (var u in resp3){

                            page = resp3[u].query.pages
                            for (var i in page){
                                correspondanceIdNom[page[i].title]=page[i].pageid;
                                blockCategories.push(page[i].pageid);
                            }
                        }

                        console.log(correspondanceIdNom);


                        group["categories"] = blockCategories;
                        group["weight"] = 1;  /* By default. For now*/
                        jsonServeur.push(group);
                        console.log(group);
                        console.log(correspondance);
                        





                        /* ON APPEL LE SERVER ET ON REÇOIT NOTRE DEMANDE */



                        var limit = 3;
                        
                       var xhr = new XMLHttpRequest();
                        xhr.open("POST", 'http://scaling-potatoes.ml/api/<'+language+'>/category?limit='+limit, true);

                        //Envoie les informations du header adaptées avec la requête
                        xhr.setRequestHeader("Content-Type", "application/json");

                        xhr.onreadystatechange = function() { //Appelle une fonction au changement d'état.
                            if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {


                                console.log("WHOA");
                        // Requête finie, traitement ici.
                            }
                        }
                        xhr.send(jsonServeur);
                        // xhr.send(new Int8Array());
                        // xhr.send(document);
                            
















                        var sortedpageViews = pageViews.sort(function(a,b){   /*We sort the contribution by the absolute value of delta size. */
                            if (a[2] < b[2] ){ return 1; } 
                            if (b[2] < a[2] ) { return -1;}
                            return 0; 
                        })

                        createRows(usersC,L,language,plateau);
                        
                        L1 = sortedpageViews.slice(0,10);
                        L2 = sortedpageViews.slice(10,20);
                        L3 = sortedpageViews.slice(20,30);
                        LCat = [L1,L2,L3];

                        nbMainCat = 3;  /* Maincat number between 2 and 5 ? */
                        Cat = ["Mathématique","Informatique","Politque"];
                        createBlock(nbMainCat,Cat);
                        document.getElementById("Titre").innerHTML = "<h1>Principale topics the users edits : </h1>";
                        for (y=0; y<nbMainCat;y++){
                            fillPage(usersC,language,L,10,LCat[y],y,nbMainCat);
                        }
                        document.getElementById("Loading").hidden = true;



                    })
            })

        })
        
    }



</script>
